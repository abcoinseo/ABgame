<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-h">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Fusnoel 8-Bit Adventure</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #2c3e50; /* Dark blue night sky */
            font-family: 'Press Start 2P', cursive;
            color: #ecf0f1; /* Light text */
            overflow: hidden; /* Prevent scrollbars */
            touch-action: manipulation; /* Prevent double-tap zoom on mobile */
        }

        #gameCanvas {
            border: 4px solid #ecf0f1;
            background-color: #3498db; /* Brighter blue for game area */
            box-shadow: 0 0 20px rgba(236, 240, 241, 0.5);
            display: block; /* Remove extra space below canvas */
        }

        #mobileControls {
            display: none; /* Hidden by default, shown via JS for touch devices */
            margin-top: 15px;
            width: 100%;
            max-width: 400px; /* Match typical canvas width */
            display: flex;
            justify-content: space-around;
        }

        .control-button {
            background-color: #e74c3c; /* Festive red */
            color: white;
            border: 2px solid #c0392b; /* Darker red border */
            padding: 15px 25px;
            font-size: 20px;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            user-select: none; /* Prevent text selection */
            border-radius: 8px;
            box-shadow: 0 4px #c0392b;
        }

        .control-button:active {
            background-color: #c0392b;
            box-shadow: 0 2px #c0392b;
            transform: translateY(2px);
        }
        
        #scoreBoard {
            margin-top: 10px;
            font-size: 1.2em;
            color: #f1c40f; /* Gold color for score */
        }

        /* Make mobile controls visible if touch is likely */
        @media (hover: none) and (pointer: coarse) {
            #mobileControls {
                display: flex;
            }
        }
        /* Alternative for JS detection based visibility */
        .mobile-controls-visible {
            display: flex !important;
        }

    </style>
</head>
<body>

    <div id="scoreBoard">Score: 0</div>
    <canvas id="gameCanvas"></canvas>
    <div id="mobileControls">
        <button id="leftButton" class="control-button">LEFT</button>
        <button id="rightButton" class="control-button">RIGHT</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreBoard = document.getElementById('scoreBoard');

        // Game settings
        let canvasWidth = 400;
        let canvasHeight = 500;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        
        const playerWidth = 40;
        const playerHeight = 50; // Taller for Santa
        const playerSpeed = 15; // Faster movement
        const itemSize = 24; // Gifts and coal size
        const itemFallSpeedBase = 2;
        let itemFallSpeedMultiplier = 1;
        const spawnIntervalBase = 1200; // milliseconds
        let spawnInterval = spawnIntervalBase;

        let player = {
            x: canvasWidth / 2 - playerWidth / 2,
            y: canvasHeight - playerHeight - 10,
            width: playerWidth,
            height: playerHeight,
            dx: 0 // horizontal speed
        };

        let items = []; // {x, y, type: 'gift' | 'coal'}
        let score = 0;
        let gameState = 'start'; // 'start', 'playing', 'gameOver'
        let lastSpawnTime = 0;
        let animationFrameId;

        // --- PIXEL ART DRAWING FUNCTIONS ---
        // Santa Claus (Simplified)
        function drawPlayer(x, y, width, height) {
            // Hat
            ctx.fillStyle = '#c0392b'; // Red
            ctx.fillRect(x + width * 0.2, y, width * 0.6, height * 0.3); // Main hat
            ctx.fillStyle = '#ecf0f1'; // White
            ctx.fillRect(x + width * 0.1, y + height * 0.25, width * 0.8, height * 0.1); // Hat brim
            ctx.fillRect(x + width * 0.7, y - height * 0.05, width * 0.2, height * 0.15); // Hat pompom base

            // Face
            ctx.fillStyle = '#f39c12'; // Skin tone (orangey for pixel feel)
            ctx.fillRect(x + width * 0.25, y + height * 0.3, width * 0.5, height * 0.2);

            // Beard
            ctx.fillStyle = '#ecf0f1'; // White
            ctx.fillRect(x + width * 0.15, y + height * 0.45, width * 0.7, height * 0.25); // Main beard
            ctx.fillRect(x + width * 0.3, y + height * 0.4, width * 0.4, height * 0.1); // Moustache part

            // Body
            ctx.fillStyle = '#c0392b'; // Red
            ctx.fillRect(x, y + height * 0.6, width, height * 0.4);

            // Belt
            ctx.fillStyle = '#2c3e50'; // Black
            ctx.fillRect(x, y + height * 0.7, width, height * 0.1);
            ctx.fillStyle = '#f1c40f'; // Gold buckle
            ctx.fillRect(x + width * 0.4, y + height * 0.7, width * 0.2, height * 0.1);
        }

        // Gift Box
        function drawGift(x, y, size) {
            const colors = ['#2ecc71', '#e74c3c', '#3498db', '#f1c40f']; // Green, Red, Blue, Yellow
            const baseColor = colors[Math.floor(Math.random() * colors.length)];
            const ribbonColor = '#f1c40f'; // Gold ribbon

            ctx.fillStyle = baseColor;
            ctx.fillRect(x, y, size, size);
            
            // Ribbon
            ctx.fillStyle = ribbonColor;
            ctx.fillRect(x + size * 0.4, y, size * 0.2, size); // Vertical
            ctx.fillRect(x, y + size * 0.4, size, size * 0.2); // Horizontal

            // Bow knot
            ctx.fillRect(x + size * 0.3, y + size * 0.3, size * 0.4, size * 0.4);
        }

        // Coal
        function drawCoal(x, y, size) {
            ctx.fillStyle = '#34495e'; // Dark grey
            ctx.fillRect(x, y, size, size);
            // Add some lighter specks for texture
            ctx.fillStyle = '#7f8c8d'; // Lighter grey
            ctx.fillRect(x + size * 0.2, y + size * 0.2, size * 0.3, size * 0.3);
            ctx.fillRect(x + size * 0.5, y + size * 0.6, size * 0.2, size * 0.2);
        }
        
        // --- GAME LOGIC ---
        function spawnItem() {
            const type = Math.random() < 0.75 ? 'gift' : 'coal'; // 75% chance for gift
            const x = Math.random() * (canvasWidth - itemSize);
            items.push({ x: x, y: -itemSize, type: type });
        }

        function update() {
            if (gameState !== 'playing') return;

            // Move player
            player.x += player.dx;

            // Keep player within bounds
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvasWidth) player.x = canvasWidth - player.width;

            // Move items and check collisions
            for (let i = items.length - 1; i >= 0; i--) {
                const item = items[i];
                item.y += itemFallSpeedBase * itemFallSpeedMultiplier;

                // Collision with player
                if (item.y + itemSize > player.y &&
                    item.y < player.y + player.height &&
                    item.x + itemSize > player.x &&
                    item.x < player.x + player.width) {
                    
                    if (item.type === 'gift') {
                        score++;
                        scoreBoard.textContent = `Score: ${score}`;
                        // Increase difficulty slightly
                        itemFallSpeedMultiplier += 0.02;
                        if (spawnInterval > 400) { // Max spawn rate
                           spawnInterval -= 20;
                        }
                    } else { // Coal
                        gameState = 'gameOver';
                    }
                    items.splice(i, 1); // Remove item
                } 
                // Item missed (goes off screen)
                else if (item.y > canvasHeight) {
                    items.splice(i, 1);
                    if (item.type === 'gift') { // Penalty for missing gift
                        // score = Math.max(0, score - 1); // Optional penalty
                        // scoreBoard.textContent = `Score: ${score}`;
                    }
                }
            }

            // Spawn new items
            const currentTime = Date.now();
            if (currentTime - lastSpawnTime > spawnInterval) {
                spawnItem();
                lastSpawnTime = currentTime;
            }
        }

        function drawBackground() {
            // Sky
            ctx.fillStyle = '#3498db'; // Game area sky
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);

            // Simple snow ground
            ctx.fillStyle = '#ecf0f1'; // White
            ctx.fillRect(0, canvasHeight - 10, canvasWidth, 10);

            // Some falling snowflakes (decorative)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            for(let i=0; i<20; i++) {
                const x = Math.random() * canvasWidth;
                const y = (Math.random() * canvasHeight * 2 + Date.now()*0.01) % canvasHeight; // slow fall
                const size = Math.random() * 3 + 1;
                ctx.fillRect(x, y, size, size);
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            drawBackground();

            if (gameState === 'start') {
                ctx.fillStyle = '#ecf0f1';
                ctx.textAlign = 'center';
                ctx.font = '24px "Press Start 2P"';
                ctx.fillText('Fusnoel Catch!', canvasWidth / 2, canvasHeight / 3);
                ctx.font = '16px "Press Start 2P"';
                ctx.fillText('Collect Gifts, Avoid Coal!', canvasWidth / 2, canvasHeight / 2);
                ctx.fillText('Press Enter or Tap to Start', canvasWidth / 2, canvasHeight / 2 + 40);
            } else if (gameState === 'playing') {
                drawPlayer(player.x, player.y, player.width, player.height);
                items.forEach(item => {
                    if (item.type === 'gift') {
                        drawGift(item.x, item.y, itemSize);
                    } else {
                        drawCoal(item.x, item.y, itemSize);
                    }
                });
            } else if (gameState === 'gameOver') {
                ctx.fillStyle = '#e74c3c';
                ctx.textAlign = 'center';
                ctx.font = '30px "Press Start 2P"';
                ctx.fillText('Game Over!', canvasWidth / 2, canvasHeight / 3);
                ctx.fillStyle = '#ecf0f1';
                ctx.font = '20px "Press Start 2P"';
                ctx.fillText(`Final Score: ${score}`, canvasWidth / 2, canvasHeight / 2);
                ctx.font = '16px "Press Start 2P"';
                ctx.fillText('Press Enter or Tap to Retry', canvasWidth / 2, canvasHeight / 2 + 50);
            }
        }

        function gameLoop() {
            update();
            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function resetGame() {
            player.x = canvasWidth / 2 - playerWidth / 2;
            player.dx = 0;
            items = [];
            score = 0;
            itemFallSpeedMultiplier = 1;
            spawnInterval = spawnIntervalBase;
            lastSpawnTime = Date.now();
            scoreBoard.textContent = `Score: ${score}`;
            gameState = 'playing';
        }

        function startGame() {
            if (gameState === 'playing') return;
            resetGame();
            if (!animationFrameId) { // Ensure loop only starts once
                gameLoop();
            }
        }

        // --- EVENT LISTENERS ---
        function handleKeyDown(e) {
            if (gameState === 'playing') {
                if (e.key === 'ArrowLeft' || e.key === 'a') {
                    player.dx = -playerSpeed;
                } else if (e.key === 'ArrowRight' || e.key === 'd') {
                    player.dx = playerSpeed;
                }
            }
            if (e.key === 'Enter' && (gameState === 'start' || gameState === 'gameOver')) {
                startGame();
            }
        }

        function handleKeyUp(e) {
            if (gameState === 'playing') {
                if ((e.key === 'ArrowLeft' || e.key === 'a') && player.dx < 0) {
                    player.dx = 0;
                } else if ((e.key === 'ArrowRight' || e.key === 'd') && player.dx > 0) {
                    player.dx = 0;
                }
            }
        }
        
        // Touch controls
        const leftButton = document.getElementById('leftButton');
        const rightButton = document.getElementById('rightButton');
        const mobileControlsDiv = document.getElementById('mobileControls');

        // Check for touch device more reliably
        function isTouchDevice() {
            return (('ontouchstart' in window) ||
                (navigator.maxTouchPoints > 0) ||
                (navigator.msMaxTouchPoints > 0));
        }

        if (isTouchDevice()) {
            mobileControlsDiv.classList.add('mobile-controls-visible');
        }

        leftButton.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Prevent click, scroll, zoom
            if (gameState === 'playing') player.dx = -playerSpeed;
        }, { passive: false });
        leftButton.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (gameState === 'playing' && player.dx < 0) player.dx = 0;
        }, { passive: false });

        rightButton.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameState === 'playing') player.dx = playerSpeed;
        }, { passive: false });
        rightButton.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (gameState === 'playing' && player.dx > 0) player.dx = 0;
        }, { passive: false });

        // Canvas click/tap for starting/restarting
        canvas.addEventListener('click', () => {
            if (gameState === 'start' || gameState === 'gameOver') {
                startGame();
            }
        });
         canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Important for mobile to prevent double actions
            if (gameState === 'start' || gameState === 'gameOver') {
                startGame();
            }
        }, { passive: false });


        document.addEventListener('keydown', handleKeyDown);
        document.addEventListener('keyup', handleKeyUp);

        // Initial Draw (Start Screen)
        draw(); 
        // If you want the game to start immediately without a start screen, call startGame() here
        // and change initial gameState to 'playing'.
        // For now, we show the start screen.
    </script>

</body>
</html>
