<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pixel Farm Pro (Lite)</title>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #333;
            color: #fff;
            touch-action: manipulation; /* Prevents zoom on double tap for mobile */
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid #555;
            padding: 10px;
            background-color: #222;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        #game-world {
            display: grid;
            border: 2px solid #777;
            background-color: #8b5a2b; /* Dirt background */
            image-rendering: pixelated; /* Makes emojis look more blocky */
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            margin-bottom: 10px;
            position: relative; /* For player positioning */
        }

        .tile {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px; /* Emoji size */
            border: 1px solid #4a3b2a; /* Faint grid lines */
            box-sizing: border-box;
        }

        .tile.grass { background-color: #5dbb63; }
        .tile.tilled { background-color: #8B4513; } /* Brown for tilled soil */
        .tile.watered { filter: brightness(1.2) saturate(1.5); } /* Slightly brighter/wetter look */

        #player {
            position: absolute;
            width: 32px;
            height: 32px;
            font-size: 28px; /* Player emoji size */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: top 0.1s linear, left 0.1s linear;
            z-index: 10;
        }

        #ui-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 350px; /* Max width for UI */
            margin-top: 10px;
        }

        #tool-selection, #inventory, #message-log {
            background-color: #444;
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 5px;
            width: 90%;
            text-align: center;
        }

        #tool-selection button, .control-button {
            font-family: 'Courier New', Courier, monospace;
            background-color: #555;
            color: #fff;
            border: 1px solid #777;
            padding: 8px 12px;
            margin: 3px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 3px;
        }
        #tool-selection button.selected, .control-button:active {
            background-color: #777;
            border-color: #999;
        }

        #controls {
            display: none; /* Hidden by default, shown for touch */
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
            width: 150px; /* Compact size for controls */
        }
        .control-button.dpad { grid-column: 2; }
        .control-button.action { grid-column: 1 / span 3; } /* Action button spans all columns */

        /* Media query for touch devices to show on-screen controls */
        @media (hover: none) and (pointer: coarse) {
            #controls {
                display: grid;
            }
        }

    </style>
</head>
<body>
    <div id="game-container">
        <h1>Pixel Farm Pro (Lite)</h1>
        <div id="game-world">
            <!-- Tiles will be generated by JS -->
            <div id="player">üë®‚Äçüåæ</div>
        </div>
        <div id="ui-panel">
            <div id="tool-selection">
                Current Tool: <span id="current-tool-display">‚úã</span><br>
                <button data-tool="hoe">‚õèÔ∏è Hoe</button>
                <button data-tool="seeds">üå± Seeds</button>
                <button data-tool="watercan">üíß Water</button>
                <button data-tool="hand" class="selected">‚úã Hand</button>
            </div>
            <div id="inventory">
                Seeds: <span id="seed-count">5</span> | Wheat: <span id="wheat-count">0</span>
            </div>
            <div id="message-log">Welcome to Pixel Farm!</div>
            <div id="controls">
                <div></div> <button class="control-button dpad" data-action="move-up">‚¨ÜÔ∏è</button> <div></div>
                <button class="control-button" data-action="move-left">‚¨ÖÔ∏è</button>
                <button class="control-button action" data-action="interact">ACT</button>
                <button class="control-button" data-action="move-right">‚û°Ô∏è</button>
                <div></div> <button class="control-button dpad" data-action="move-down">‚¨áÔ∏è</button> <div></div>
            </div>
        </div>
    </div>

    <script>
        const TILE_SIZE = 32; // pixels
        const WORLD_WIDTH = 10; // tiles
        const WORLD_HEIGHT = 8; // tiles

        const gameWorld = document.getElementById('game-world');
        const playerElement = document.getElementById('player');
        const currentToolDisplay = document.getElementById('current-tool-display');
        const seedCountDisplay = document.getElementById('seed-count');
        const wheatCountDisplay = document.getElementById('wheat-count');
        const messageLog = document.getElementById('message-log');
        const toolButtons = document.querySelectorAll('#tool-selection button');

        // --- Game State ---
        let player = {
            x: Math.floor(WORLD_WIDTH / 2),
            y: Math.floor(WORLD_HEIGHT / 2),
            currentTool: 'hand', // 'hoe', 'seeds', 'watercan', 'hand'
            inventory: {
                seeds: 5,
                wheat: 0
            }
        };

        let worldMap = []; // 2D array of tile objects

        // Tile types and their properties
        const TILE_TYPES = {
            GRASS: { id: 'grass', emoji: '', interactive: true, canTill: true },
            TILLED_SOIL: { id: 'tilled', emoji: '', interactive: true, canPlant: true },
            SEEDED: { id: 'seeded', emoji: 'üå±', growTime: 10, nextStage: 'GROWING_WHEAT', requiresWater: true, waterLevel: 0, maxWater: 3 }, // growTime in game ticks (seconds)
            GROWING_WHEAT: { id: 'growing_wheat', emoji: 'üåø', growTime: 15, nextStage: 'RIPE_WHEAT', requiresWater: true, waterLevel: 0, maxWater: 5 },
            RIPE_WHEAT: { id: 'ripe_wheat', emoji: 'üåæ', interactive: true, canHarvest: true }
        };

        // --- Initialization ---
        function initGame() {
            gameWorld.style.width = `${WORLD_WIDTH * TILE_SIZE}px`;
            gameWorld.style.height = `${WORLD_HEIGHT * TILE_SIZE}px`;
            gameWorld.style.gridTemplateColumns = `repeat(${WORLD_WIDTH}, 1fr)`;

            for (let y = 0; y < WORLD_HEIGHT; y++) {
                worldMap[y] = [];
                for (let x = 0; x < WORLD_WIDTH; x++) {
                    // Create a varied starting map (optional)
                    let tileType = TILE_TYPES.GRASS;
                    if (Math.random() < 0.1 && (x > 0 && x < WORLD_WIDTH -1 && y > 0 && y < WORLD_HEIGHT -1)) {
                        // Small chance of already tilled patch for variety
                        // tileType = TILE_TYPES.TILLED_SOIL;
                    }
                    worldMap[y][x] = { ...tileType, x, y }; // Spread to make a copy
                    if (tileType.requiresWater) {
                        worldMap[y][x].waterLevel = 0;
                        worldMap[y][x].growProgress = 0;
                    }
                }
            }
            renderWorld();
            renderPlayer();
            updateUI();
            logMessage("Use WASD/Arrows or on-screen buttons to move. Space/ACT to interact.");
        }

        // --- Rendering ---
        function renderWorld() {
            gameWorld.innerHTML = ''; // Clear previous tiles, keep player separate
            gameWorld.appendChild(playerElement); // Re-add player to ensure it's on top

            for (let y = 0; y < WORLD_HEIGHT; y++) {
                for (let x = 0; x < WORLD_WIDTH; x++) {
                    const tileData = worldMap[y][x];
                    const tileDiv = document.createElement('div');
                    tileDiv.classList.add('tile');
                    tileDiv.classList.add(tileData.id); // e.g., 'grass', 'tilled'
                    tileDiv.textContent = tileData.emoji || '';
                    
                    if (tileData.requiresWater && tileData.waterLevel > 0 && tileData.id !== TILE_TYPES.RIPE_WHEAT.id) {
                        tileDiv.classList.add('watered');
                    }
                    // For debugging water/growth:
                    // tileDiv.title = `X:${x},Y:${y} ${tileData.id} Water:${tileData.waterLevel || 0} Grow:${tileData.growProgress || 0}`;
                    gameWorld.appendChild(tileDiv);
                }
            }
        }

        function renderPlayer() {
            playerElement.style.left = `${player.x * TILE_SIZE}px`;
            playerElement.style.top = `${player.y * TILE_SIZE}px`;
        }

        function updateUI() {
            currentToolDisplay.textContent = getToolEmoji(player.currentTool);
            seedCountDisplay.textContent = player.inventory.seeds;
            wheatCountDisplay.textContent = player.inventory.wheat;

            toolButtons.forEach(button => {
                button.classList.remove('selected');
                if (button.dataset.tool === player.currentTool) {
                    button.classList.add('selected');
                }
            });
        }

        function getToolEmoji(toolName) {
            switch(toolName) {
                case 'hoe': return '‚õèÔ∏è';
                case 'seeds': return 'üå±';
                case 'watercan': return 'üíß';
                case 'hand': return '‚úã';
                default: return '?';
            }
        }

        function logMessage(message) {
            messageLog.textContent = message;
            // Optional: clear message after some time
            // setTimeout(() => { if (messageLog.textContent === message) messageLog.textContent = ""; }, 3000);
        }


        // --- Game Logic ---
        function movePlayer(dx, dy) {
            const newX = player.x + dx;
            const newY = player.y + dy;

            if (newX >= 0 && newX < WORLD_WIDTH && newY >= 0 && newY < WORLD_HEIGHT) {
                player.x = newX;
                player.y = newY;
                renderPlayer();
                // logMessage(`Moved to ${player.x}, ${player.y}`);
            } else {
                logMessage("Can't move there!");
            }
        }

        function interact() {
            const currentTile = worldMap[player.y][player.x];
            logMessage(""); // Clear previous message

            switch (player.currentTool) {
                case 'hoe':
                    if (currentTile.canTill) {
                        worldMap[player.y][player.x] = { ...TILE_TYPES.TILLED_SOIL, x: player.x, y: player.y };
                        logMessage("Tilled the soil!");
                        renderWorld();
                    } else {
                        logMessage("Cannot till this spot.");
                    }
                    break;
                case 'seeds':
                    if (currentTile.canPlant) {
                        if (player.inventory.seeds > 0) {
                            worldMap[player.y][player.x] = { ...TILE_TYPES.SEEDED, x: player.x, y: player.y, waterLevel: 0, growProgress: 0 };
                            player.inventory.seeds--;
                            logMessage("Planted seeds!");
                            updateUI();
                            renderWorld();
                        } else {
                            logMessage("No seeds left!");
                        }
                    } else {
                        logMessage("Cannot plant here. Till soil first.");
                    }
                    break;
                case 'watercan':
                    if (currentTile.requiresWater && currentTile.id !== TILE_TYPES.RIPE_WHEAT.id) {
                        currentTile.waterLevel = Math.min(currentTile.waterLevel + 1, currentTile.maxWater);
                        logMessage("Watered the plant. Water: " + currentTile.waterLevel);
                        renderWorld(); // To show watered state
                    } else {
                        logMessage("No need to water this.");
                    }
                    break;
                case 'hand':
                    if (currentTile.canHarvest) {
                        player.inventory.wheat += Math.floor(Math.random() * 3) + 1; // Harvest 1-3 wheat
                        worldMap[player.y][player.x] = { ...TILE_TYPES.TILLED_SOIL, x: player.x, y: player.y }; // Becomes tilled soil again
                        logMessage("Harvested wheat!");
                        updateUI();
                        renderWorld();
                    } else {
                        logMessage("Nothing to harvest here.");
                    }
                    break;
            }
        }

        function gameLoop() {
            // Crop growth logic
            for (let y = 0; y < WORLD_HEIGHT; y++) {
                for (let x = 0; x < WORLD_WIDTH; x++) {
                    const tile = worldMap[y][x];
                    if (tile.requiresWater && tile.id !== TILE_TYPES.RIPE_WHEAT.id) {
                        if (tile.waterLevel > 0) {
                            tile.growProgress++;
                            tile.waterLevel = Math.max(0, tile.waterLevel - 0.25); // Water depletes slowly

                            if (tile.growProgress >= tile.growTime) {
                                const nextStageData = TILE_TYPES[tile.nextStage];
                                worldMap[y][x] = { ...nextStageData, x: tile.x, y: tile.y };
                                if (nextStageData.requiresWater) {
                                    worldMap[y][x].waterLevel = 0; // Reset water for next stage if needed
                                    worldMap[y][x].growProgress = 0;
                                }
                                logMessage(`A plant at ${x},${y} grew!`);
                                renderWorld(); // Update display immediately
                            }
                        } else {
                            // Optional: Plants could wither or growth could halt/reverse if not watered
                            // tile.growProgress = Math.max(0, tile.growProgress - 0.1); 
                        }
                    }
                }
            }
             // Occasional re-render if nothing else triggered it and growth happened.
             // For simplicity, we re-render on interaction or when growth stage changes.
        }

        // --- Input Handling ---
        document.addEventListener('keydown', (e) => {
            // Prevent default for arrow keys and space to avoid page scroll
            if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight", "Space"].includes(e.code)) {
                e.preventDefault();
            }

            switch (e.key.toLowerCase()) {
                case 'w': case 'arrowup': movePlayer(0, -1); break;
                case 's': case 'arrowdown': movePlayer(0, 1); break;
                case 'a': case 'arrowleft': movePlayer(-1, 0); break;
                case 'd': case 'arrowright': movePlayer(1, 0); break;
                case ' ': interact(); break; // Space bar for interaction
                // Tool selection via numbers (optional)
                case '1': selectTool('hoe'); break;
                case '2': selectTool('seeds'); break;
                case '3': selectTool('watercan'); break;
                case '4': selectTool('hand'); break;
            }
        });

        function selectTool(toolName) {
            player.currentTool = toolName;
            updateUI();
            logMessage(`Selected ${toolName}.`);
        }

        toolButtons.forEach(button => {
            button.addEventListener('click', () => {
                selectTool(button.dataset.tool);
            });
        });

        // On-screen controls for touch
        const onScreenControls = document.getElementById('controls');
        onScreenControls.addEventListener('click', (e) => {
            const targetButton = e.target.closest('.control-button');
            if (!targetButton) return;

            const action = targetButton.dataset.action;
            switch (action) {
                case 'move-up': movePlayer(0, -1); break;
                case 'move-down': movePlayer(0, 1); break;
                case 'move-left': movePlayer(-1, 0); break;
                case 'move-right': movePlayer(1, 0); break;
                case 'interact': interact(); break;
            }
        });


        // --- Start Game ---
        initGame();
        setInterval(gameLoop, 1000); // Game tick every second for growth

    </script>
</body>
</html>
